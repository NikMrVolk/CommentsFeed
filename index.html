<!DOCTYPE html>
<html>

<head>
	<title>Проект "Комменты"</title>
	<link rel="stylesheet" href="styles.css" />
</head>

<body>
	<div class="container">
		<ul class="comments" id="commentsList"></ul>
		<div class="add-form">
			<input type="text" class="add-form-name" placeholder="Введите ваше имя" id="nameInput" />
			<textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"
				id="textInput"></textarea>
			<div class="add-form-row">
				<button class="add-form-button" id="buttonAddComments">Написать</button>
			</div>
		</div>
		<button class="add-form-button" id="buttonDeleteLastComment">Удалить последний комментарий</button>
	</div>
</body>

<script>
	const commentsList = document.getElementById("commentsList");
	const buttonAddComments = document.getElementById("buttonAddComments");
	const buttonDeleteLastComment = document.getElementById("buttonDeleteLastComment");
	const nameInput = document.getElementById("nameInput");
	let textInput = document.getElementById("textInput");

	const comments = [
		{
			userName: "Глеб Фокин",
			commentDate: "12/02/2022, 12:18:00",
			commentText: "Это будет первый комментарий на этой странице",
			likesCounter: 3,
			likeInfo: false,
			isEdit: false,
			isAnswer: false,
		},
		{
			userName: "Варвара Н.",
			commentDate: "13/02/2022, 19:22:00",
			commentText: "Мне нравится как оформлена эта страница! ❤",
			likesCounter: 75,
			likeInfo: true,
			isEdit: false,
			isAnswer: false,
		},
	];

	const renderComments = () => {
		const commentsHTML = comments.map((comment, index) => {
			return `<li class="comment" data-index="${index}">
		<div class="comment-header">
			<div>${comment.userName.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll('"', "&quot;")}</div>
			<div>${comment.commentDate}</div>
		</div>
		<div class="comment-body">
			<div class="comment-text">
				${comment.commentText.replaceAll("QUOTE_BEGIN", "<div class='quote'>").replaceAll("QUOTE_END", "</div>")}
			</div>
		</div>
		<div class="comment-footer">
			<div class=edit>
				<button class="add-form-button edit-button" data-index="${index}">${comment.isEdit ? "Сохранить" : "Редактировать"}</button>
			</div>
			<div class="likes">
				<span class="likes-counter">${comment.likesCounter}</span>
				<button class="like-button ${comment.likeInfo ? "-active-like" : ""}" data-index="${index}" data-likes="${comment.likesCounter}"></button>
			</div>
		</div>
	</li>`
		}).join("");
		commentsList.innerHTML = commentsHTML;
		addCommentLike();
		// editComments();
		answerComment();
	}

	const addCommentLike = () => {
		const commentsLikes = document.querySelectorAll(".like-button");
		for (const commentsLike of commentsLikes) {
			commentsLike.addEventListener("click", (event) => {
				event.stopPropagation();
				const index = commentsLike.dataset.index;
				if (comments[index].likeInfo === true) {
					comments[index].likesCounter -= 1;
					comments[index].likeInfo = false;
				} else {
					comments[index].likesCounter += 1;
					comments[index].likeInfo = true;
				}
				renderComments();
			});
		}
	}

	// const editComments = () => {
	// 	const editCommentsButtons = document.querySelectorAll(".edit-button");
	// 	for (const editCommentsButton of editCommentsButtons) {
	// 		editCommentsButton.addEventListener("click", (event) => {
	// 			event.stopPropagation();
	// 			const index = editCommentsButton.dataset.index;
	// 			if (comments[index].isEdit === true) {
	// 				const textInputEditComment = document.getElementById("textInputEditComment");
	// 				comments[index].commentText = textInputEditComment.value;
	// 				comments[index].isEdit = false;
	// 			} else {
	// 				comments[index].commentText = `<textarea type="textarea" class="form-edit-comment" rows="4"
	// 			id="textInputEditComment">${comments[index].commentText}</textarea>`
	// 				comments[index].isEdit = true;
	// 			}
	// 			renderComments();
	// 		});
	// 	}
	// }

	const answerComment = () => {
		const commentsBody = document.querySelectorAll(".comment");
		for (const commentBody of commentsBody) {
			commentBody.addEventListener("click", () => {
				const index = commentBody.dataset.index;
				if (comments[index].isAnswer === false) {
					textInput.value = `QUOTE_BEGIN ${comments[index].userName}:
${comments[index].commentText} QUOTE_END`
				}
				renderComments();
			});
		}
	}

	// =====================================================================================================================
	// Код, не позволяющий добавить комментарий и окрашивающий кнопку в серый, пока содержимое
	// полей ввода пустое

	// buttonAddComments.disabled = "true";

	// const validateForm = () => {
	// 	if (nameInput.value.trim() === "") {
	// 		buttonAddComments.disabled = true;
	// 		return;
	// 	}
	// 	if (textInput.value.trim() === "") {
	// 		buttonAddComments.disabled = true;
	// 		return;
	// 	}
	// 	buttonAddComments.disabled = false;
	// }

	// nameInput.addEventListener("input", validateForm);
	// textInput.addEventListener("input", validateForm);
	// =====================================================================================================================

	renderComments();

	const addNewComment = () => {
		// =====================================================================================================================
		// Код для фиксации текущих даты и времени к каждому новому комментарию
		let myFullDate = new Date();
		let myDate = myFullDate.toLocaleString();
		// =====================================================================================================================

		// =====================================================================================================================
		// Код, который не позволяет добавить комментарий на страницу в случае, если одно из полей не заполнено,
		// при этом незаполненное поле изменяет свой стиль и окрашивается в красный цвет
		if (nameInput.value === "") {
			nameInput.classList.add("empty-place");
			return;
		} else {
			nameInput.classList.remove("empty-place");
		}
		if (textInput.value === "") {
			textInput.classList.add("empty-place");
			return;
		} else {
			textInput.classList.remove("empty-place");
		}
		// =====================================================================================================================

		comments.push(
			{
				userName: nameInput.value,
				commentDate: myDate,
				commentText: textInput.value.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll('"', "&quot;"),
				likesCounter: 0,
				likeInfo: false,
				isEdit: false,
				isAnswer: false,
			}
		)

		nameInput.value = "";
		textInput.value = "";

		renderComments();
	}

	buttonAddComments.addEventListener("click", addNewComment);

	// =====================================================================================================================
	// Добавление комментария при нажатии на Enter
	// document.addEventListener("keyup", e => {
	// 	if (e.key === "Enter") {
	// 		addNewComment();
	// 	}
	// });
	// =====================================================================================================================

	// =====================================================================================================================
	// Удаление крайнего комментария
	buttonDeleteLastComment.addEventListener("click", () => {
		commentsList.lastChild.remove();
	});
// =====================================================================================================================
</script>

</html>